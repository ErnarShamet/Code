<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validator | Проверка Ввода на Угрозы</title>
    <!-- Загрузка Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray background */
        }
        .result-box {
            border-left-width: 6px;
        }
    </style>
</head>
<body class="p-4 md:p-8 flex items-center justify-center min-h-screen">

    <div class="w-full max-w-4xl bg-white p-6 md:p-10 rounded-2xl shadow-2xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-gray-800 mb-2">
                Анализатор Ввода <span class="text-indigo-600">Security Guard</span>
            </h1>
            <p class="text-gray-600">
                Инструмент для проверки данных на XSS, SQL Injection и потенциальный фишинг.
            </p>
        </header>

        <!-- Поле ввода -->
        <div class="mb-6">
            <label for="inputData" class="block text-lg font-semibold text-gray-700 mb-2">
                Введите данные для анализа:
            </label>
            <textarea id="inputData" rows="6" placeholder="Например: <script>alert('XSS')</script> или ' OR 1=1 --"
                      class="w-full p-4 border-2 border-gray-300 rounded-xl resize-none focus:border-indigo-500 focus:ring-indigo-500 transition duration-150"></textarea>
        </div>

        <!-- Кнопка анализа -->
        <button onclick="analyzeInput()"
                class="w-full bg-indigo-600 text-white p-4 rounded-xl font-bold text-lg hover:bg-indigo-700 transition duration-150 transform hover:scale-105">
            ПРОАНАЛИЗИРОВАТЬ
        </button>

        <!-- Контейнер результатов -->
        <div id="resultsContainer" class="mt-8 space-y-4">
            <!-- Результаты будут здесь -->
            <div id="initialMessage" class="bg-blue-100 border-l-4 border-blue-500 text-blue-800 p-4 rounded-lg result-box">
                <p class="font-semibold">Ожидание ввода.</p>
                <p class="text-sm">Введите потенциально опасный код, чтобы увидеть, как его распознает валидатор.</p>
            </div>
        </div>
        
    </div>

    <!-- JavaScript Logic -->
    <script>
        // Функция для преобразования текста в безопасный HTML (предотвращает XSS в самой странице)
        const escapeHTML = (str) => {
            return str.replace(/&/g, '&amp;')
                      .replace(/</g, '&lt;')
                      .replace(/>/g, '&gt;')
                      .replace(/"/g, '&quot;')
                      .replace(/'/g, '&#39;');
        };

        const analyzeInput = () => {
            const input = document.getElementById('inputData').value.trim();
            const resultsContainer = document.getElementById('resultsContainer');
            resultsContainer.innerHTML = '';
            
            if (!input) {
                resultsContainer.innerHTML = `
                    <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 p-4 rounded-lg result-box">
                        <p class="font-semibold">Ошибка!</p>
                        <p class="text-sm">Поле ввода не может быть пустым.</p>
                    </div>
                `;
                return;
            }

            // Массивы для хранения найденных угроз
            let threatsFound = [];
            let isClean = true;

            // 1. Проверка на XSS (Cross-Site Scripting)
            checkXss(input, threatsFound);

            // 2. Проверка на SQL Injection
            checkSqlInjection(input, threatsFound);

            // 3. Проверка на Phishing/Sensitive Data (Базовая)
            checkPhishing(input, threatsFound);
            
            // 4. Проверка на подозрительное кодирование (Base64)
            checkBase64(input, threatsFound);

            // Вывод итогового результата
            if (threatsFound.length > 0) {
                isClean = false;
                displayOverallResult(false, threatsFound.length);
                threatsFound.forEach(threat => displayThreat(threat));
            } else {
                displayOverallResult(true);
            }
        };

        // --- ЛОГИКА ПРОВЕРКИ XSS ---
        const checkXss = (input, threats) => {
            const xssPatterns = [
                { pattern: /<\s*script\s*[^>]*>/gi, description: "Тег `<script>` - прямой вызов JavaScript." },
                { pattern: /on[a-z]+\s*=/gi, description: "Обработчик событий `on...=` (например, `onerror` или `onload`), используется для выполнения JS без тега <script>." },
                { pattern: /javascript\s*:/gi, description: "Протокол `javascript:` в атрибутах, таких как `href`." },
                { pattern: /<img[^>]*src\s*=\s*['"]?data:text\/html/gi, description: "Использование Data URI для встраивания HTML." },
                { pattern: /<iframe/gi, description: "Тег `<iframe>` для встраивания внешнего контента." },
            ];

            xssPatterns.forEach(item => {
                if (item.pattern.test(input)) {
                    threats.push({
                        type: "XSS (Cross-Site Scripting)",
                        severity: "ВЫСОКАЯ",
                        color: "red",
                        reason: item.description,
                        example: input.match(item.pattern)[0]
                    });
                }
            });
        };

        // --- ЛОГИКА ПРОВЕРКИ SQL INJECTION ---
        const checkSqlInjection = (input, threats) => {
            const sqliPatterns = [
                { pattern: /'\s*OR\s*1\s*=\s*1\s*--/gi, description: "Классическая инъекция для обхода аутентификации (' OR 1=1 --)." },
                { pattern: /UNION\s+SELECT/gi, description: "Использование `UNION SELECT` для извлечения данных из других таблиц." },
                { pattern: /DROP\s+TABLE/gi, description: "Команда `DROP TABLE` для удаления таблиц из базы данных." },
                { pattern: /;[\s]*\w/gi, description: "Разделитель команд `;` для выполнения нескольких SQL-операторов подряд." },
                { pattern: /SELECT\s+\*\s+FROM/gi, description: "Прямой запрос `SELECT * FROM`." },
            ];

            sqliPatterns.forEach(item => {
                if (item.pattern.test(input)) {
                    threats.push({
                        type: "SQL Injection",
                        severity: "КРИТИЧЕСКАЯ",
                        color: "red",
                        reason: item.description,
                        example: input.match(item.pattern)[0]
                    });
                }
            });
        };

        // --- ЛОГИКА ПРОВЕРКИ PHISHING/SENSITIVE DATA ---
        const checkPhishing = (input, threats) => {
            const sensitiveKeywords = ['password', 'login', 'account', 'verify', 'пароль', 'аккаунт', 'верификация'];
            const urlPattern = /(https?:\/\/[^\s]+)/gi;

            let containsUrl = urlPattern.test(input);
            let containsSensitive = sensitiveKeywords.some(keyword => input.toLowerCase().includes(keyword));

            if (containsUrl && containsSensitive) {
                 threats.push({
                    type: "Phishing / Сбор данных",
                    severity: "ВЫСОКАЯ",
                    color: "orange",
                    reason: "Ввод содержит как URL, так и чувствительные ключевые слова (пароль, аккаунт). Может быть попыткой фишинга.",
                    example: "Содержит URL и чувствительные слова."
                });
            } else if (containsSensitive) {
                 threats.push({
                    type: "Sensitive Data",
                    severity: "НИЗКАЯ",
                    color: "yellow",
                    reason: "Ввод содержит чувствительные ключевые слова (например, 'пароль'). Никогда не храните пароли в открытом виде.",
                    example: sensitiveKeywords.filter(k => input.toLowerCase().includes(k)).join(', ')
                });
            }
        };
        
        // --- ЛОГИКА ПРОВЕРКИ BASE64 (Подозрительное кодирование) ---
        const checkBase64 = (input, threats) => {
            // Регулярное выражение для Base64 (минимум 16 символов, кратно 4, содержит A-Z, a-z, 0-9, +/ и = в конце)
            const base64Pattern = /([A-Za-z0-9+/]{16,}={0,2})/g;
            
            // Проверка, что найдено совпадение и что это не просто обычное слово
            let matches = input.match(base64Pattern);
            if (matches) {
                 threats.push({
                    type: "Подозрительное кодирование",
                    severity: "СРЕДНЯЯ",
                    color: "yellow",
                    reason: "Обнаружена длинная строка в формате Base64. Злоумышленники часто используют Base64 для сокрытия XSS или других полезных нагрузок.",
                    example: matches[0].substring(0, 30) + '...'
                });
            }
        };

        // --- ФУНКЦИИ ВЫВОДА UI ---
        
        // Выводит общий результат анализа
        const displayOverallResult = (isClean, threatCount = 0) => {
            const container = document.getElementById('resultsContainer');
            
            let color, borderColor, bgColor, text;
            if (isClean) {
                color = 'green';
                borderColor = 'border-green-500';
                bgColor = 'bg-green-100';
                text = "БЕЗОПАСНО: Явных угроз не найдено. Помните: этот инструмент не гарантирует 100% защиты, используйте его для обучения.";
            } else {
                color = 'red';
                borderColor = 'border-red-500';
                bgColor = 'bg-red-100';
                text = `ОБНАРУЖЕНЫ УГРОЗЫ! Найдено ${threatCount} потенциальных проблем. Необходимо дополнительное санирование и валидация.`;
            }

            const overallDiv = document.createElement('div');
            overallDiv.className = `${bgColor} ${borderColor} text-${color}-800 p-4 rounded-lg font-bold result-box transition duration-300`;
            overallDiv.innerHTML = `<p>${text}</p>`;
            container.appendChild(overallDiv);
        };

        // Выводит карточку с деталями угрозы
        const displayThreat = (threat) => {
            const container = document.getElementById('resultsContainer');
            
            const bgColorMap = { 'red': 'bg-red-50', 'orange': 'bg-orange-50', 'yellow': 'bg-yellow-50' };
            const textColorMap = { 'red': 'text-red-800', 'orange': 'text-orange-800', 'yellow': 'text-yellow-800' };
            const borderColorMap = { 'red': 'border-red-500', 'orange': 'border-orange-500', 'yellow': 'border-yellow-500' };

            const card = document.createElement('div');
            card.className = `p-4 rounded-lg result-box ${bgColorMap[threat.color]} ${borderColorMap[threat.color]}`;
            card.innerHTML = `
                <div class="flex items-center mb-2">
                    <span class="text-xs font-bold uppercase py-1 px-3 rounded-full ${textColorMap[threat.color]} bg-opacity-75 ${borderColorMap[threat.color].replace('border', 'bg')}">
                        ${threat.severity}
                    </span>
                    <h4 class="ml-3 text-lg font-bold ${textColorMap[threat.color]}">${threat.type}</h4>
                </div>
                <p class="text-sm text-gray-700 mb-2">${threat.reason}</p>
                <div class="bg-gray-100 p-3 rounded-lg text-sm font-mono whitespace-pre-wrap break-all">
                    ${escapeHTML(threat.example)}
                </div>
            `;
            container.appendChild(card);
        };
    </script>
</body>
</html>
