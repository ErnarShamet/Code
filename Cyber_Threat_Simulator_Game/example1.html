<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyber Threat Simulator Game</title>
    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Roboto+Mono:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117; /* GitHub Dark Theme Background */
            color: #c9d1d9;
        }
        .console-font {
            font-family: 'Roboto Mono', monospace;
        }
        .game-card {
            background-color: #161b22; /* Slightly lighter than body */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            border: 1px solid #30363d;
        }
        .node {
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }
        .node:hover {
            transform: scale(1.05);
        }
        .node-selected {
            border-color: #38a169; /* Green border for selection */
            box-shadow: 0 0 10px rgba(56, 161, 105, 0.5);
        }
        .node-active {
            animation: pulse 1s infinite alternate;
        }
        @keyframes pulse {
            from { box-shadow: 0 0 10px rgba(255, 255, 255, 0.2); }
            to { box-shadow: 0 0 20px rgba(52, 211, 163, 0.8); }
        }
        /* –ê–Ω–∏–º–∞—Ü–∏—è –∞—Ç–∞–∫–∏ */
        .attack-line {
            position: absolute;
            height: 3px;
            background-color: #ff0000;
            opacity: 0.8;
            pointer-events: none;
            transition: opacity 0.1s ease-out;
            animation: attack-flow 0.5s linear infinite;
        }
        @keyframes attack-flow {
            from { background-position: 0 0; }
            to { background-position: -100px 0; }
        }
    </style>
</head>
<body class="p-4 md:p-8 flex items-start justify-center min-h-screen">

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–∏–º—É–ª—è—Ç–æ—Ä–∞ -->
    <div class="w-full max-w-6xl game-card p-6 md:p-8 rounded-xl">
        <header class="text-center mb-6">
            <h1 class="text-3xl md:text-4xl font-extrabold text-blue-400 mb-2">
                Cyber Threat Simulator
            </h1>
            <p class="text-gray-400 console-font">
                // v1.0 | –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∑–∞—â–∏—Ç—É –∏–ª–∏ –ø—Ä–æ–≤–µ–¥–∏—Ç–µ –∞—Ç–∞–∫—É
            </p>
        </header>

        <!-- –°—Ç–∞—Ç—É—Å –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 text-sm console-font">
            <div class="p-3 bg-gray-800 rounded-lg">–†–µ–∂–∏–º: <span id="modeDisplay" class="font-bold text-yellow-400">–ó–ê–©–ò–¢–ê</span></div>
            <div class="p-3 bg-gray-800 rounded-lg">–ë—é–¥–∂–µ—Ç: <span id="budgetDisplay" class="font-bold text-green-400">10000 $</span></div>
            <div class="p-3 bg-gray-800 rounded-lg">–†–µ–π—Ç–∏–Ω–≥ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: <span id="ratingDisplay" class="font-bold text-red-400">F</span></div>
        </div>

        <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –æ–±–ª–∞—Å—Ç—å: –ö–∞—Ä—Ç–∞ —Å–µ—Ç–∏ –∏ –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

            <!-- –ö–æ–ª–æ–Ω–∫–∞ 1: –ö–∞—Ä—Ç–∞ —Å–µ—Ç–∏ (–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è) -->
            <div class="lg:col-span-2 p-4 bg-gray-800 rounded-xl h-96 relative flex flex-col items-center justify-around border border-gray-700">
                <h2 class="text-xl font-semibold mb-3 text-blue-300">–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ö–∞—Ä—Ç–∞ –°–µ—Ç–∏</h2>
                <div id="networkMap" class="w-full h-full flex items-center justify-center relative">
                    <!-- Nodes will be rendered here -->
                </div>
                <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –∞—Ç–∞–∫–∏ -->
                <div id="attackAnimations" class="absolute inset-0 pointer-events-none"></div>
            </div>

            <!-- –ö–æ–ª–æ–Ω–∫–∞ 2: –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –ö–æ–Ω—Å–æ–ª—å -->
            <div class="lg:col-span-1 flex flex-col space-y-4">
                
                <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –†–µ–∂–∏–º–∞ -->
                <div class="p-4 game-card rounded-xl">
                    <label class="block text-md font-semibold mb-2">–í—ã–±–µ—Ä–∏—Ç–µ –†–µ–∂–∏–º:</label>
                    <select id="gameMode" onchange="setMode(this.value)"
                            class="w-full p-2 bg-gray-700 rounded-lg border border-gray-600 text-white focus:ring-blue-500 focus:border-blue-500">
                        <option value="DEFENSE">–†–µ–∂–∏–º –ó–∞—â–∏—Ç—ã (Defender)</option>
                        <option value="ATTACK">–†–µ–∂–∏–º –ê—Ç–∞–∫–∏ (Attacker)</option>
                    </select>
                </div>

                <!-- –ü–∞–Ω–µ–ª—å –ó–∞—â–∏—Ç–Ω–∏–∫–∞ (Defense Mode) -->
                <div id="defensePanel" class="p-4 game-card rounded-xl">
                    <h3 class="text-lg font-bold mb-3 text-green-400">–£–ª—É—á—à–µ–Ω–∏–µ –ó–∞—â–∏—Ç—ã</h3>
                    <div id="defenseActions" class="space-y-3">
                        <!-- Defense upgrades will be rendered here -->
                    </div>
                </div>

                <!-- –ü–∞–Ω–µ–ª—å –ê—Ç–∞–∫—É—é—â–µ–≥–æ (Attack Mode) -->
                <div id="attackPanel" class="p-4 game-card rounded-xl hidden">
                    <h3 class="text-lg font-bold mb-3 text-red-400">–í—ã–±–æ—Ä –ê—Ç–∞–∫–∏</h3>
                    <div class="mb-3">
                         <label class="block text-sm mb-1 text-gray-400">–¶–µ–ª—å:</label>
                         <div id="targetNodeDisplay" class="p-2 bg-gray-700 rounded-lg console-font">–í—ã–±–µ—Ä–∏—Ç–µ —É–∑–µ–ª –Ω–∞ –∫–∞—Ä—Ç–µ</div>
                    </div>
                    <div id="attackActions" class="space-y-3">
                        <!-- Attack options will be rendered here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- –ö–æ–Ω—Å–æ–ª—å –õ–æ–≥–æ–≤ -->
        <div class="mt-6 p-4 bg-gray-900 rounded-xl border border-gray-700">
            <h2 class="text-xl font-semibold mb-3 text-blue-300">–ö–æ–Ω—Å–æ–ª—å –õ–æ–≥–æ–≤</h2>
            <div id="logConsole" class="h-40 overflow-y-auto console-font text-sm p-2 bg-black rounded-lg text-green-300 space-y-1">
                <p>> –°–∏—Å—Ç–µ–º–∞ –∑–∞–ø—É—â–µ–Ω–∞. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∏...</p>
            </div>
        </div>

    </div>

    <!-- JavaScript Game Logic -->
    <script>
        // --- Game State and Constants ---
        const initialBudget = 100000000;
        let gameMode = 'DEFENSE';
        let currentBudget = initialBudget;
        let selectedNodeId = null;
        
        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É–∑–ª–æ–≤ —Å–µ—Ç–∏ –∏ –∏—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
        const NETWORK_NODES = {
            'FIREWALL': { name: 'Firewall / Edge', icon: 'üîí', type: 'Gateway', defense: { firewall: 1, waf: 0, training: 0 }, security: 10, targetable: false, position: { x: 50, y: 10 } },
            'WEB_SERVER': { name: 'Web Server (WWW)', icon: 'üåê', type: 'Server', defense: { firewall: 0, waf: 0, training: 0 }, security: 5, targetable: true, position: { x: 25, y: 50 } },
            'DB_SERVER': { name: 'Database Server (DB)', icon: 'üíæ', type: 'Server', defense: { firewall: 0, waf: 0, training: 0 }, security: 20, targetable: true, position: { x: 75, y: 50 } },
            'WORKSTATION': { name: 'Workstation (User)', icon: 'üíª', type: 'Client', defense: { firewall: 0, waf: 0, training: 0 }, security: 2, targetable: true, position: { x: 50, y: 90 } },
        };
        
        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –∞—Ç–∞–∫ (–°–ª–æ–∂–Ω–æ—Å—Ç—å –∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å)
        const ATTACKS = [
            { id: 'PHISHING', name: 'Phishing (–§–∏—à–∏–Ω–≥)', cost: 100, difficulty: 5, defenseNeeded: 'training', targetType: 'Client', description: '–¶–µ–ª—å: User Workstation. –û–±—Ö–æ–¥–∏—Ç Training/Firewall.' },
            { id: 'SQLI', name: 'SQL Injection (SQLi)', cost: 300, difficulty: 15, defenseNeeded: 'waf', targetType: 'Server', description: '–¶–µ–ª—å: DB Server. –û–±—Ö–æ–¥–∏—Ç WAF/Firewall.' },
            { id: 'BRUTE_FORCE', name: 'Brute Force (–ü–µ—Ä–µ–±–æ—Ä)', cost: 200, difficulty: 10, defenseNeeded: 'firewall', targetType: 'Server', description: '–¶–µ–ª—å: Web Server. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è Firewall.' },
        ];

        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–∞—â–∏—Ç–Ω—ã—Ö –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤
        const DEFENSES = [
            { id: 'FIREWALL', name: '–£–ª—É—á—à–∏—Ç—å Firewall (L1)', cost: 500, defenseType: 'firewall', maxLevel: 3, description: '–ë–∞–∑–æ–≤–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–±–æ—Ä–∞.' },
            { id: 'WAF', name: '–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å WAF (L1)', cost: 1500, defenseType: 'waf', maxLevel: 2, description: '–ó–∞—â–∏—Ç–∞ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (SQLi/XSS).' },
            { id: 'TRAINING', name: '–ü—Ä–æ–≤–µ—Å—Ç–∏ Training (L1)', cost: 1000, defenseType: 'training', maxLevel: 1, description: '–û–±—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–§–∏—à–∏–Ω–≥).' },
        ];


        // --- Core Game Functions ---

        /**
         * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –∏–≥—Ä—É
         */
        function initializeGame() {
            setMode(gameMode);
            renderNetworkMap();
            renderDefenseActions();
            renderAttackActions();
            updateStats();
            logMessage("–°–∏–º—É–ª—è—Ç–æ—Ä –≥–æ—Ç–æ–≤. –ù–∞—á–Ω–∏—Ç–µ –≤ —Ä–µ–∂–∏–º–µ '–ó–∞—â–∏—Ç–∞'.", 'info');
        }

        /**
         * –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —Ä–µ–∂–∏–º –∏–≥—Ä—ã (–ó–∞—â–∏—Ç–∞/–ê—Ç–∞–∫–∞)
         * @param {string} mode - 'DEFENSE' –∏–ª–∏ 'ATTACK'
         */
        function setMode(mode) {
            gameMode = mode;
            document.getElementById('modeDisplay').textContent = mode === 'DEFENSE' ? '–ó–ê–©–ò–¢–ê' : '–ê–¢–ê–ö–ê';
            document.getElementById('modeDisplay').className = mode === 'DEFENSE' ? 'font-bold text-yellow-400' : 'font-bold text-red-400';
            
            document.getElementById('defensePanel').classList.toggle('hidden', mode !== 'DEFENSE');
            document.getElementById('attackPanel').classList.toggle('hidden', mode !== 'ATTACK');
            
            selectedNodeId = null;
            document.getElementById('targetNodeDisplay').textContent = '–í—ã–±–µ—Ä–∏—Ç–µ —É–∑–µ–ª –Ω–∞ –∫–∞—Ä—Ç–µ';
            renderNetworkMap(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ –¥–ª—è —Å–±—Ä–æ—Å–∞ –≤—ã–¥–µ–ª–µ–Ω–∏—è
            logMessage(`–†–µ–∂–∏–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω –Ω–∞: ${mode}`, 'info');
        }

        /**
         * –û–±–Ω–æ–≤–ª—è–µ—Ç –≤—Å–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–ë—é–¥–∂–µ—Ç, –†–µ–π—Ç–∏–Ω–≥)
         */
        function updateStats() {
            document.getElementById('budgetDisplay').textContent = `${currentBudget.toLocaleString()} $`;
            const rating = calculateSecurityRating();
            document.getElementById('ratingDisplay').textContent = rating.grade;
            document.getElementById('ratingDisplay').className = `font-bold ${rating.color}`;
        }

        /**
         * –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –æ–±—â–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞—â–∏—Ç—ã —É–∑–ª–æ–≤
         * @returns {{grade: string, color: string}}
         */
        function calculateSecurityRating() {
            let totalDefense = 0;
            let maxDefense = 0;
            
            // –ü—Ä–æ—Å—Ç–∞—è —Å—É–º–º–∞ –≤—Å–µ—Ö –∑–∞—â–∏—Ç–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π, –∫—Ä–æ–º–µ FIREWALL, —Ç.–∫. –æ–Ω –≤—Å–µ–≥–¥–∞ 1.
            const targetNodes = ['WEB_SERVER', 'DB_SERVER', 'WORKSTATION'];

            targetNodes.forEach(id => {
                const node = NETWORK_NODES[id];
                totalDefense += (node.defense.firewall + node.defense.waf * 2 + node.defense.training * 3); // –í–∑–≤–µ—à–∏–≤–∞–µ–º –∑–∞—â–∏—Ç—É
                maxDefense += (1 + 2 * 2 + 1 * 3); // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≤–æ–∑–º–æ–∂–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
            });

            const score = totalDefense / maxDefense;
            
            let grade, color;
            if (score >= 0.8) { grade = 'A'; color = 'text-green-500'; }
            else if (score >= 0.6) { grade = 'B'; color = 'text-lime-500'; }
            else if (score >= 0.4) { grade = 'C'; color = 'text-yellow-500'; }
            else if (score >= 0.2) { grade = 'D'; color = 'text-orange-500'; }
            else { grade = 'F'; color = 'text-red-500'; }

            return { grade, color };
        }

        /**
         * –î–æ–±–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª—å –ª–æ–≥–æ–≤.
         * @param {string} message - –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è.
         * @param {string} type - –¢–∏–ø: 'attack', 'defense', 'error', 'info'.
         */
        function logMessage(message, type) {
            const console = document.getElementById('logConsole');
            const now = new Date();
            const time = now.toLocaleTimeString('ru-RU');
            
            let color = 'text-gray-300';
            let prefix = '//';

            switch (type) {
                case 'attack': color = 'text-red-400'; prefix = 'ATTACK> '; break;
                case 'defense': color = 'text-green-400'; prefix = 'DEFEND> '; break;
                case 'error': color = 'text-yellow-600'; prefix = 'ERROR> '; break;
                case 'info': color = 'text-blue-400'; prefix = 'SYSTEM> '; break;
            }

            const logEntry = document.createElement('p');
            logEntry.className = color;
            logEntry.innerHTML = `<span class="text-gray-500">[${time}]</span> ${prefix}${message}`;
            
            console.appendChild(logEntry);
            console.scrollTop = console.scrollHeight;
        }


        // --- Network Visualization ---

        /**
         * –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∫–∞—Ä—Ç—ã —Å–µ—Ç–∏ –∏ —É–∑–ª–æ–≤
         */
        function renderNetworkMap() {
            const map = document.getElementById('networkMap');
            map.innerHTML = '';
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –ª–∏–Ω–∏–π —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (–ü—Ä–æ—Å—Ç–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–æ –≤—Å–µ–º–∏, –∫—Ä–æ–º–µ FIREWALL)
            const nodeIds = Object.keys(NETWORK_NODES);
            const connections = [
                ['FIREWALL', 'WEB_SERVER'],
                ['FIREWALL', 'DB_SERVER'],
                ['FIREWALL', 'WORKSTATION'],
                ['WEB_SERVER', 'DB_SERVER'],
                ['DB_SERVER', 'WORKSTATION'],
            ];
            
            // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –ª–∏–Ω–∏–π
            connections.forEach(([id1, id2]) => {
                const node1 = NETWORK_NODES[id1].position;
                const node2 = NETWORK_NODES[id2].position;
                
                const distance = Math.sqrt(Math.pow(node1.x - node2.x, 2) + Math.pow(node1.y - node2.y, 2));
                const angle = Math.atan2(node2.y - node1.y, node2.x - node1.x) * (180 / Math.PI);

                const line = document.createElement('div');
                line.style.position = 'absolute';
                line.style.width = `${distance * 0.9}rem`; // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ % –≤ rem –¥–ª—è –º–∞—Å—à—Ç–∞–±–∞
                line.style.height = '1px';
                line.style.backgroundColor = '#4b5563'; // Gray line
                line.style.left = `${node1.x}%`;
                line.style.top = `${node1.y}%`;
                line.style.transformOrigin = '0 0';
                line.style.transform = `translate(-50%, -50%) rotate(${angle}deg)`;
                map.appendChild(line);
            });

            // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —É–∑–ª–æ–≤
            nodeIds.forEach(id => {
                const nodeData = NETWORK_NODES[id];
                
                const nodeEl = document.createElement('div');
                nodeEl.id = `node-${id}`;
                nodeEl.className = `node absolute w-16 h-16 rounded-xl flex flex-col items-center justify-center p-2 text-center text-xs console-font bg-gray-700 hover:bg-gray-600 ${id === selectedNodeId ? 'node-selected' : ''}`;
                
                nodeEl.style.left = `${nodeData.position.x}%`;
                nodeEl.style.top = `${nodeData.position.y}%`;
                nodeEl.style.transform = 'translate(-50%, -50%)'; // –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º

                nodeEl.innerHTML = `
                    <span class="text-2xl">${nodeData.icon}</span>
                    <span class="mt-1">${nodeData.name}</span>
                `;
                
                if (nodeData.targetable) {
                    nodeEl.onclick = () => selectNode(id);
                } else if (id === 'FIREWALL') {
                    // Firewall –≤—Å–µ–≥–¥–∞ –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∑–∞—â–∏—Ç—ã –≤ —Ä–µ–∂–∏–º–µ DEFENSE
                    nodeEl.onclick = () => selectNode(id);
                }

                map.appendChild(nodeEl);
            });
        }
        
        /**
         * –í—ã–±–æ—Ä —É–∑–ª–∞ –Ω–∞ –∫–∞—Ä—Ç–µ
         * @param {string} id - ID –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —É–∑–ª–∞
         */
        function selectNode(id) {
            selectedNodeId = id;
            renderNetworkMap();
            
            document.getElementById('targetNodeDisplay').textContent = NETWORK_NODES[id].name;
            logMessage(`–í—ã–±—Ä–∞–Ω —É–∑–µ–ª: ${NETWORK_NODES[id].name}.`, 'info');
            
            // –ï—Å–ª–∏ —Ä–µ–∂–∏–º –∑–∞—â–∏—Ç—ã, –æ–±–Ω–æ–≤–ª—è–µ–º –¥–µ–π—Å—Ç–≤–∏—è –∑–∞—â–∏—Ç—ã –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —É–∑–ª–∞
            if (gameMode === 'DEFENSE') {
                renderDefenseActions();
            }
        }


        // --- Defense Mode Logic ---

        /**
         * –†–µ–Ω–¥–µ—Ä–∏—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –∑–∞—â–∏—Ç—ã
         */
        function renderDefenseActions() {
            const container = document.getElementById('defenseActions');
            container.innerHTML = '';

            // –ï—Å–ª–∏ —É–∑–µ–ª –Ω–µ –≤—ã–±—Ä–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            if (!selectedNodeId) {
                container.innerHTML = '<p class="text-sm text-gray-400">–í—ã–±–µ—Ä–∏—Ç–µ —É–∑–µ–ª –Ω–∞ –∫–∞—Ä—Ç–µ, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è.</p>';
                return;
            }
            
            const node = NETWORK_NODES[selectedNodeId];
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–µ –∑–∞—â–∏—Ç—ã
            let defenseHtml = `<p class="text-xs font-semibold text-blue-300 mb-2">–¢–µ–∫—É—â–∞—è –ó–∞—â–∏—Ç–∞:</p>`;
            for (const type in node.defense) {
                 defenseHtml += `<p class="text-xs console-font ml-2">${type}: ${node.defense[type]}</p>`;
            }
            container.innerHTML += defenseHtml;

            // –†–µ–Ω–¥–µ—Ä–∏–º –∫–Ω–æ–ø–∫–∏ —É–ª—É—á—à–µ–Ω–∏–π
            DEFENSES.forEach(def => {
                const currentLevel = node.defense[def.defenseType];
                const isDisabled = currentBudget < def.cost || currentLevel >= def.maxLevel;
                const button = document.createElement('button');
                
                button.className = `w-full p-2 rounded-lg font-semibold text-sm transition ${isDisabled ? 'bg-gray-600 text-gray-400 cursor-not-allowed opacity-50' : 'bg-green-600 hover:bg-green-700 text-white'}`;
                button.textContent = `${def.name} (${def.cost} $)`;
                button.disabled = isDisabled;
                button.onclick = () => applyDefense(def.defenseType, def.cost, def.maxLevel);
                
                if (currentLevel >= def.maxLevel) {
                     button.textContent = `${def.name} (MAX)`;
                }

                container.appendChild(button);
            });
        }

        /**
         * –ü—Ä–∏–º–µ–Ω—è–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—É—é –∑–∞—â–∏—Ç—É –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —É–∑–ª—É
         * @param {string} defenseType - –¢–∏–ø –∑–∞—â–∏—Ç—ã ('firewall', 'waf', 'training')
         * @param {number} cost - –°—Ç–æ–∏–º–æ—Å—Ç—å
         * @param {number} maxLevel - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
         */
        function applyDefense(defenseType, cost, maxLevel) {
            if (!selectedNodeId) return;
            const node = NETWORK_NODES[selectedNodeId];

            if (currentBudget < cost) {
                logMessage("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±—é–¥–∂–µ—Ç–∞ –¥–ª—è —ç—Ç–æ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è.", 'error');
                return;
            }

            if (node.defense[defenseType] >= maxLevel) {
                logMessage(`–ó–∞—â–∏—Ç–∞ ${defenseType} –Ω–∞ —É–∑–ª–µ ${node.name} —É–∂–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è.`, 'error');
                return;
            }

            currentBudget -= cost;
            node.defense[defenseType] += 1;
            
            logMessage(`–£–ª—É—á—à–µ–Ω–∏–µ ${defenseType} –ø—Ä–∏–º–µ–Ω–µ–Ω–æ –∫ ${node.name}. –ë—é–¥–∂–µ—Ç: -${cost} $.`, 'defense');
            
            renderDefenseActions();
            updateStats();
        }


        // --- Attack Mode Logic ---

        /**
         * –†–µ–Ω–¥–µ—Ä–∏—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –∞—Ç–∞–∫–∏
         */
        function renderAttackActions() {
            const container = document.getElementById('attackActions');
            container.innerHTML = '';
            
            ATTACKS.forEach(attack => {
                const isDisabled = currentBudget < attack.cost;
                const button = document.createElement('button');
                
                button.className = `w-full p-2 rounded-lg font-semibold text-sm transition ${isDisabled ? 'bg-gray-600 text-gray-400 cursor-not-allowed opacity-50' : 'bg-red-600 hover:bg-red-700 text-white'}`;
                button.textContent = `${attack.name} (${attack.cost} $) - D: ${attack.difficulty}`;
                button.disabled = isDisabled;
                button.title = attack.description;
                button.onclick = () => launchAttack(attack.id);

                container.appendChild(button);
            });
        }
        
        /**
         * –ó–∞–ø—É—Å–∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∞—Ç–∞–∫–∏
         * @param {string} attackId - ID –∞—Ç–∞–∫–∏
         */
        function launchAttack(attackId) {
            if (!selectedNodeId) {
                logMessage("–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª–µ–≤–æ–π —É–∑–µ–ª –¥–ª—è –∞—Ç–∞–∫–∏.", 'error');
                return;
            }

            const attack = ATTACKS.find(a => a.id === attackId);
            const targetNode = NETWORK_NODES[selectedNodeId];
            const sourceNode = NETWORK_NODES['FIREWALL']; // –í—Å–µ –∞—Ç–∞–∫–∏ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å Edge
            
            if (currentBudget < attack.cost) {
                logMessage("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±—é–¥–∂–µ—Ç–∞ –¥–ª—è —ç—Ç–æ–π –∞—Ç–∞–∫–∏.", 'error');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –∞—Ç–∞–∫–∏ –∏ —Ü–µ–ª–∏
            if ((attackId === 'SQLI' && targetNode.name !== 'Database Server (DB)') ||
                (attackId === 'BRUTE_FORCE' && targetNode.name !== 'Web Server (WWW)') ||
                (attackId === 'PHISHING' && targetNode.name !== 'Workstation (User)')) {
                 logMessage(`–ê—Ç–∞–∫–∞ ${attack.name} –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞ –ø—Ä–æ—Ç–∏–≤ —É–∑–ª–∞ ${targetNode.name}.`, 'error');
                 return;
            }

            currentBudget -= attack.cost;
            logMessage(`–ù–∞—á–∞–ª–æ –∞—Ç–∞–∫–∏ '${attack.name}' –Ω–∞ ${targetNode.name}... (–°—Ç–æ–∏–º–æ—Å—Ç—å: ${attack.cost} $)`, 'attack');
            updateStats();
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –∞—Ç–∞–∫–∏
            animateAttack(sourceNode.position, targetNode.position);
            
            // –†–∞—Å—á–µ—Ç —à–∞–Ω—Å–æ–≤ –Ω–∞ —É—Å–ø–µ—Ö (–°–∏–º—É–ª—è—Ü–∏—è)
            setTimeout(() => {
                const targetDefenseLevel = targetNode.defense[attack.defenseNeeded];
                // –®–∞–Ω—Å —É—Å–ø–µ—Ö–∞ (–ø—Ä–æ—Å—Ç–æ–µ –æ–±—Ä–∞—Ç–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ): 
                // 1.0 (100% –±–µ–∑ –∑–∞—â–∏—Ç—ã) - (0.2 * —É—Ä–æ–≤–µ–Ω—å –∑–∞—â–∏—Ç—ã)
                let successChance = 1.0 - (0.2 * targetDefenseLevel) - (0.01 * targetNode.security);
                successChance = Math.max(0.1, successChance); // –ú–∏–Ω–∏–º—É–º 10%
                
                const success = Math.random() < successChance;

                if (success) {
                    logMessage(`[–£–°–ü–ï–•] –ê—Ç–∞–∫–∞ '${attack.name}' —Å—Ä–∞–±–æ—Ç–∞–ª–∞! –ó–∞—â–∏—Ç–∞ ${attack.defenseNeeded} –ø—Ä–æ–π–¥–µ–Ω–∞.`, 'attack');
                    // –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –∞—Ç–∞–∫–µ, —Å–Ω–∏–∂–∞–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —É–∑–ª–∞
                    targetNode.security = Math.max(1, targetNode.security - 5); 
                    logMessage(`–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å ${targetNode.name} —Å–Ω–∏–∂–µ–Ω–∞ –¥–æ ${targetNode.security}.`, 'attack');
                } else {
                    logMessage(`[–ü–†–û–ò–ì–†–´–®] –ê—Ç–∞–∫–∞ '${attack.name}' –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –∑–∞—â–∏—Ç–æ–π ${attack.defenseNeeded}.`, 'defense');
                }
                updateStats();
            }, 1000); // –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
        }
        
        /**
         * –°–æ–∑–¥–∞–µ—Ç –≤–∏–∑—É–∞–ª—å–Ω—É—é –∞–Ω–∏–º–∞—Ü–∏—é –∞—Ç–∞–∫–∏
         */
        function animateAttack(startPos, endPos) {
            const mapRect = document.getElementById('networkMap').getBoundingClientRect();
            const container = document.getElementById('attackAnimations');
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ % –≤ –ø–∏–∫—Å–µ–ª–∏
            const startX = mapRect.width * (startPos.x / 100);
            const startY = mapRect.height * (startPos.y / 100);
            const endX = mapRect.width * (endPos.x / 100);
            const endY = mapRect.height * (endPos.y / 100);

            const dx = endX - startX;
            const dy = endY - startY;
            const distance = Math.sqrt(dx * dx + dy * dy);
            const angle = Math.atan2(dy, dx) * (180 / Math.PI);

            const line = document.createElement('div');
            line.className = 'attack-line';
            line.style.width = `${distance}px`;
            line.style.left = `${startX}px`;
            line.style.top = `${startY}px`;
            line.style.transformOrigin = '0 0';
            line.style.transform = `rotate(${angle}deg)`;
            
            container.appendChild(line);

            // –£–¥–∞–ª–µ–Ω–∏–µ –ª–∏–Ω–∏–∏ –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
            setTimeout(() => {
                line.style.opacity = '0';
                setTimeout(() => line.remove(), 100);
            }, 900);
        }


        // --- Initialization ---
        window.onload = initializeGame;

    </script>
</body>
</html>
